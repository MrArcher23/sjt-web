---
// portafolio.astro - Refactorizado usando BaseLayout

// Layout
import BaseLayout from "../layouts/BaseLayout.astro";

// Strapi
import strapi from "../utils/strapi";
import type { 
  ProjectCard as ProjectCardType,
  ProjectShowcase as ProjectShowcaseType 
} from "../types/strapi";

// Importar im√°genes locales espec√≠ficas para esta p√°gina
import panoramica1 from "../assets/images/work/panoramica1.jpeg";
// import obra1 from "../assets/images/work/obra1.jpeg"; // No usado actualmente
import doraMaria from "../assets/images/work/DoraMaria.jpg";
import ganadero from "../assets/images/work/ganadero.jpg";
import centla from "../assets/images/work/centla.jpg";
import pavimento from "../assets/images/work/pavimento-hidraulico.jpg";
import anticorrosion from "../assets/images/work/anticorrosion.jpg";
import procesoobra1 from "../assets/images/work/procesoobra1.jpg";
import procesoobra2 from "../assets/images/work/procesoobra2.jpg";
import procesoobra3 from "../assets/images/work/procesoobra3.jpg";
import procesoobra4 from "../assets/images/work/procesoobra4.jpg";


// Componentes espec√≠ficos para esta p√°gina
import HeroSection from "../components/HeroSection.astro";
import SectionTitle from "../components/ui/SectionTitle.astro";
import ProjectShowcase from "../components/ui/ProjectShowcase.astro";
import ProjectCarousel from "../components/ui/ProjectCarousel.astro";
import ProjectCard from "../components/ui/ProjectCard.astro";
// import ProjectFilter from "../components/ui/ProjectFilter.astro"; // No usado actualmente

// Datos de proyectos (usando Unsplash como solicita el usuario)
const featuredProject = {
  title: "Complejo Industrial Petrolero Dos Bocas",
  subtitle: "Proyecto Emblem√°tico Nacional",
  description:
    "Desarrollo integral de infraestructura para la nueva refiner√≠a de Dos Bocas, incluyendo construcci√≥n de instalaciones industriales, sistemas electromec√°nicos avanzados y obras civiles especializadas. Un proyecto de m√°s de 18 meses que representa la excelencia en ingenier√≠a mexicana.",
  category: "Desarrollo Integral",
  location: "Para√≠so, Tabasco",
  year: "2024",
  client: "PEMEX",
  heroImage:
    "https://images.unsplash.com/photo-1581094794329-c8112a89af12?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80",
  categoryColor: "var(--purple)",
  stats: [
    { value: "18", label: "Meses de Ejecuci√≥n" },
    { value: "450M", label: "Inversi√≥n (MXN)" },
    { value: "200+", label: "Especialistas" },
    { value: "12", label: "Estructuras Construidas" },
  ],
  highlights: [
    "Primera refiner√≠a construida en M√©xico en 40 a√±os con tecnolog√≠a de vanguardia",
    "Integraci√≥n de sistemas automatizados para control de procesos industriales",
    "Cumplimiento de est√°ndares internacionales ISO 9001, 14001 y 45001",
    "Coordinaci√≥n con m√°s de 15 empresas especializadas a nivel nacional",
    "Implementaci√≥n de tecnolog√≠as sustentables y eficiencia energ√©tica",
  ],
};

const carouselProject = {
  title: "Infraestructura Vial Integral en Frontera, Centla, Tabasco",
  category: "Terracer√≠as & Carreteras",
  categoryColor: "var(--green)",
  description:
    "Proyecto de construcci√≥n completa de infraestructura urbana en la Calle Carlos A. Madrazo, entre las calles Jos√© Mar√≠a Pino Su√°rez y Andr√©s S√°nchez Magallanes, Frontera, Centla, Tabasco.",
  images: [
    {
      src: procesoobra1.src,
      alt: "Vista panor√°mica de la carretera en construcci√≥n",
      caption: "Fase de demolici√≥n y excavaci√≥n.",
    },
    {
      src: procesoobra2.src,
      alt: "Equipos de construcci√≥n trabajando",
      caption: "Compactaci√≥n del terreno.",
    },
    {
      src: procesoobra3.src,
      alt: "Pavimentaci√≥n asf√°ltica en progreso",
      caption: "Colocaci√≥n de material base",
    },
    {
      src: procesoobra4.src,
      alt: "Carretera terminada",
      caption: "Pavimento terminado.",
    },
  ],
};

// Categor√≠as para filtros
// const filterCategories = [
//   {
//     id: "construccion",
//     label: "Construcci√≥n & Obra Civil",
//     color: "var(--orange)",
//     count: 12,
//   },
//   {
//     id: "terracerias",
//     label: "Terracer√≠as & Carreteras",
//     color: "var(--green)",
//     count: 8,
//   },
//   {
//     id: "electromecanica",
//     label: "Electromec√°nica",
//     color: "var(--blue)",
//     count: 6,
//   },
//   {
//     id: "desarrollo",
//     label: "Desarrollo Integral",
//     color: "var(--purple)",
//     count: 4,
//   },
// ];

// ==================== OBTENER PROYECTOS DE STRAPI ====================
let strapiProjects: ProjectCardType[] = [];
let portafolioDestacadoStrapi: ProjectShowcaseType | null = null;

// üöÄ OPTIMIZACI√ìN: Llamadas paralelas con manejo de errores independiente
// üìä Llamada 1: Project Cards (puede fallar si no hay contenido)
try {
  const response = await strapi.getProjectCards({
    pagination: { pageSize: 100 },
    sort: ["year:desc", "createdAt:desc"],
  });
  strapiProjects = response?.data || [];
} catch (error) {
  // Silencioso: usar fallback hardcodeado
  strapiProjects = [];
}

// üéØ Llamada 2: Project Showcase (independiente de la anterior)
try {
  portafolioDestacadoStrapi = await strapi.getProjectShowcaseByIdentifier("portafolio-destacado");
} catch (error) {
  // Silencioso: usar fallback hardcodeado
  portafolioDestacadoStrapi = null;
}

// Transformar datos de Strapi al formato esperado por ProjectCard
const strapiProjectsFormatted = strapiProjects.map((project) => ({
  title: project.title,
  category: project.category,
  categoryColor:
    project.categoryColor === "custom"
      ? project.customCategoryColor || "var(--blue)"
      : project.categoryColor,
  location: project.location,
  year: project.year,
  image: project.image?.url || "/images/default-project.jpg",
  description: project.description,
  client: project.client || undefined,
  status: project.status,
  tags: project.tags?.map((tag) => tag.name) || [],
  href: `/proyecto/${project.title
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^\w-]/g, "")}`,
}));

// Grid de proyectos hardcodeados (mantener como fallback)
const projectsGridHardcoded = [
  {
    title: "Rehabilitacion de nave 2 DEL ‚ÄúParque Tabasco, Dora Maria",
    category: "Construcci√≥n & Obra Civil",
    categoryColor: "var(--orange)",
    location: "Vhsa, Tabasco",
    year: "2024",
    image: doraMaria.src,
    description:
      "Impermeabilizaci√≥n ‚Ä¢ Reparaci√≥n de fisuras y mantenimiento a canalones ‚Ä¢ Mantenimiento a ba√±os ‚Ä¢ Canceler√≠a de aluminio ‚Ä¢ Ducteria, luminarias y salidas de corriente. ‚Ä¢ Aplicaci√≥n de pintura en muros.",
    client: "Secretaria de Turismo",
    status: "completed" as const,
    tags: ["Construcci√≥n", "Rehabilitaci√≥n", "Ingenier√≠a Civil"],
  },
  {
    title: "Mantenimiento de Stand Ganadero del \"Parque Tabasco, Dora Maria\" ",
    category: "Construcci√≥n & Obra Civil",
    categoryColor: "var(--orange)",
    location: "Vhsa, Tabasco",
    year: "2023",
    image:ganadero.src,
    description:
      "Reparaciones en fibra de vidrio ‚Ä¢ Limpieza de √°reas verdes ‚Ä¢ Demolici√≥n y reposici√≥n de Pavimiento ‚Ä¢ Aplicaci√≥n de pintura ‚Ä¢ Construcci√≥n de bardas ‚Ä¢ Limpieza y reparaciones en Techumbres.",
    client: "Secretaria de Turismo",
    status: "completed" as const,
    tags: ["Construcci√≥n", "Rehabilitaci√≥n", "Ingenier√≠a Civil"],
  },
  {
    title: "Rehabilitacion de pavimento asfaltico",
    category: "Terracer√≠as & Carreteras",
    categoryColor: "var(--green)",
    location: "Centla, Tabasco",
    year: "2024",
    image: centla.src,
    description:
      "Rehabilitacion de pavimento asfaltico en tramos aislados en el camino ramal miramar del km 0+000 al km 4+600, en el municipio de centla, tabasco.",
    client: "SCT",
    status: "completed" as const,
    tags: ["Construcci√≥n", "Rehabilitaci√≥n", "Ingenier√≠a Civil"],
  },
  {
    title: "Construcci√≥n de pavimento de concreto hidr√°ulico",
    category: "Terracer√≠as & Carreteras",
    categoryColor: "var(--green)",
    location: "Centla, Tabasco",
    year: "2023",
    image: pavimento.src,
    description:
      "Esta obra transformar√° significativamente la conectividad del centro de Frontera, beneficiando tanto el tr√°nsito vehicular como peatonal. La inclusi√≥n del sistema de alumbrado p√∫blico mejorar√° sustancialmente la seguridad nocturna y la calidad de vida de los habitantes de la zona.",
    client: "SCT",
    status: "completed" as const,
    tags: ["Construcci√≥n", "Rehabilitaci√≥n", "Ingenier√≠a Civil"],
  },
  {
    title: "Suministro y aplicacion de proteccion anticorrosiva",
    category: "Construcci√≥n & Obra Civil", 
    categoryColor: "var(--orange)",
    location: "Campo Samaria, Tabasco",
    year: "2024",
    image: anticorrosion.src,
    description:
      "Suministro y aplicacion de proteccion anticorrosiva, mediante sistema no.3 de acuerdo con la et-053-pemex-2019 en lineas, arreglos, accesorios y valvulas en tuberia de 6\" a 12\" en el area de la refineria de dos bocas, tabasco.",
    client: "PEMEX",
    status: "completed" as const,
    tags: ["Construcci√≥n", "Rehabilitaci√≥n", "Ingenier√≠a Civil"],
  }
];

// ==================== COMBINAR PROYECTOS ====================
// Priorizar proyectos de Strapi, usar hardcodeados como fallback
const projectsGrid = [
  ...strapiProjectsFormatted,
  // Si no hay proyectos de Strapi, usar los hardcodeados
  ...(strapiProjectsFormatted.length === 0 ? projectsGridHardcoded : []),
];

// Total de proyectos combinados (Strapi + hardcodeados como fallback)

// Props espec√≠ficas para el Layout de Portafolio
const layoutProps = {
  pageTitle: "Portafolio",
  metaDescription:
    "Conoce nuestros proyectos m√°s destacados: construcci√≥n, obra civil, terracer√≠as, electromec√°nica y desarrollo integral. M√°s de 20 a√±os de experiencia en Tabasco y el sureste mexicano.",
  showBreadcrumb: false,
  breadcrumbItems: [
    { href: "/", text: "Inicio" },
    { href: "/portafolio", text: "Portafolio" },
  ],
  showContact: true,
  contactConfig: {
    highlightText: "inicia tu proyecto",
    title: "¬øTIENES UN PROYECTO EN MENTE?",
    subtitle:
      "Nuestro equipo est√° listo para convertir tu visi√≥n en realidad. Cont√°ctanos para una consulta personalizada.",
    phone: "(993) 167-4490",
    email: "asastre@sjtcontratistas.com",
    address: "Carr. Reforma-Dos Bocas s/n, Cumuapa 1ra. Tabasco",
    accentColor: "var(--orange)",
    backgroundColor: "bg-dark",
    placeholder: "Cu√©ntanos sobre tu proyecto...",
    buttonText: "Solicitar Consulta",
  },
};
---

<BaseLayout {...layoutProps}>
  <!-- ========================================= -->
  <!-- CONTENIDO ESPEC√çFICO DEL PORTAFOLIO -->
  <!-- ========================================= -->

  <!-- Hero Section -->
  <HeroSection
    name_company="Nuestro Portafolio"
    subtitle="M√°s de 30 proyectos exitosos que transforman el sureste mexicano"
    showOverlay={true}
    titlePosition="center"
    backgroundImage={panoramica1.src}
  />

  <!-- Featured Project Showcase -->
  <section class="py-16 lg:py-24 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Section Header -->
      <div class="text-center mb-16">
        <SectionTitle
          highlightText="proyecto destacado"
          title="Nuestro Trabajo M√°s Emblem√°tico"
          highlightColor="purple"
          alignment="center"
          size="lg"
        />
        <p class="text-xl text-gray-600 max-w-3xl mx-auto mt-6 leading-relaxed">
          Un ejemplo de nuestra capacidad para ejecutar proyectos de gran
          envergadura con los m√°s altos est√°ndares de calidad y tecnolog√≠a.
        </p>
      </div>

      <!-- Featured Project desde Strapi -->
      {portafolioDestacadoStrapi ? (
        <ProjectShowcase
          title={portafolioDestacadoStrapi.title}
          subtitle={portafolioDestacadoStrapi.subtitle}
          description={portafolioDestacadoStrapi.description}
          category={portafolioDestacadoStrapi.category}
          location={portafolioDestacadoStrapi.location}
          year={portafolioDestacadoStrapi.year}
          client={portafolioDestacadoStrapi.client}
          heroImage={portafolioDestacadoStrapi.heroImage?.url || featuredProject.heroImage}
          heroImageAlt={portafolioDestacadoStrapi.heroImageAlt || portafolioDestacadoStrapi.heroImage?.alternativeText}
          categoryColor={portafolioDestacadoStrapi.categoryColor === "custom" ? portafolioDestacadoStrapi.customCategoryColor || "var(--purple)" : portafolioDestacadoStrapi.categoryColor}
          stats={portafolioDestacadoStrapi.stats || []}
          highlights={portafolioDestacadoStrapi.highlights?.map(h => h.text) || []}
          titleHighlights={portafolioDestacadoStrapi.titleHighlights}
          titleStats={portafolioDestacadoStrapi.titleStats}
        />
      ) : (
        <!-- Fallback: Proyecto hardcodeado si no hay datos de Strapi -->
        <ProjectShowcase
          title={featuredProject.title}
          subtitle={featuredProject.subtitle}
          description={featuredProject.description}
          category={featuredProject.category}
          location={featuredProject.location}
          year={featuredProject.year}
          client={featuredProject.client}
          heroImage={featuredProject.heroImage}
          categoryColor={featuredProject.categoryColor}
          stats={featuredProject.stats}
          highlights={featuredProject.highlights}
          titleHighlights="Aspectos Destacados"
          titleStats="Datos del Proyecto"
        />
      )}
    </div>
  </section>

  <!-- Project Carousel Section -->
  <section class="py-16 lg:py-20 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Section Header -->
      <div class="mb-12">
        <SectionTitle
          highlightText="proceso de construcci√≥n"
          title="De la Planificaci√≥n a la Realidad"
          highlightColor="green"
          alignment="center"
          size="lg"
        />
        <p class="text-lg text-gray-600 text-center max-w-2xl mx-auto mt-6">
          Sigue el proceso completo de uno de nuestros proyectos viales m√°s
          importantes.
        </p>
      </div>

      <!-- Project Carousel -->
      <ProjectCarousel
        title={carouselProject.title}
        images={carouselProject.images}
        category={carouselProject.category}
        categoryColor={carouselProject.categoryColor}
        description={carouselProject.description}
        autoPlay={true}
        showThumbnails={true}
      />
    </div>
  </section>

  <!-- Projects Grid Section -->
  <section class="py-16 lg:py-24 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Section Header -->
      <div class="text-center mb-12">
        <SectionTitle
          highlightText="todos nuestros proyectos"
          title="Portafolio Completo de Trabajos Realizados"
          highlightColor="orange"
          alignment="center"
          size="lg"
        />
        <p class="text-lg text-gray-600 max-w-3xl mx-auto mt-6">
          Explora nuestra amplia experiencia en construcci√≥n, terracer√≠as,
          electromec√°nica y desarrollo integral de proyectos.
        </p>
      </div>

      <!-- Project Filter -->
      <!-- <ProjectFilter categories={filterCategories} defaultCategory="all" /> -->

      <!-- Projects Grid -->
      <div
        class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8"
        data-projects-container
      >
        {
          projectsGrid.map((project) => (
            <div
              data-project-category={project.category
                .toLowerCase()
                .replace(/\s+/g, "-")
                .replace("&", "")
                .replace("√°", "a")
                .replace("√©", "e")
                .replace("√≠", "i")
                .replace("√≥", "o")
                .replace("√∫", "u")}
              data-project-year={project.year}
              data-project-title={project.title}
            >
              <ProjectCard
                title={project.title}
                category={project.category}
                categoryColor={project.categoryColor}
                location={project.location}
                year={project.year}
                image={project.image}
                description={project.description}
                client={project.client}
                status={project.status}
                tags={project.tags}
                href={`/proyecto/${project.title.toLowerCase().replace(/\s+/g, "-")}`}
              />
            </div>
          ))
        }
      </div>

      <!-- Load More Button -->
      <!-- <div class="text-center mt-12">
        <button
          class="inline-flex items-center px-8 py-4 bg-gray-100 hover:bg-gray-200 text-gray-700 hover:text-gray-900 font-semibold rounded-full transition-all duration-300 group"
        >
          <span>Ver M√°s Proyectos</span>
          <svg
            class="w-5 h-5 ml-2 transition-transform duration-300 group-hover:translate-x-1"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
          </svg>
        </button>
      </div> -->
    </div>
  </section>

  <!-- <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-16">
      <SectionTitle
        highlightText="nuestros n√∫meros"
        title="Estad√≠sticas de Nuestro Portafolio"
        highlightColor="orange"
        alignment="center"
        size="lg"
      />
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
      <div class="text-center">
        <div class="text-5xl lg:text-6xl font-black text-orange-400 mb-4">
          30+
        </div>
        <div class="text-lg font-semibold text-white mb-2">
          Proyectos Completados
        </div>
        <div class="text-sm text-gray-300">En los √∫ltimos 5 a√±os</div>
      </div>

      <div class="text-center">
        <div class="text-5xl lg:text-6xl font-black text-green-400 mb-4">
          850M
        </div>
        <div class="text-lg font-semibold text-white mb-2">
          Inversi√≥n Total (MXN)
        </div>
        <div class="text-sm text-gray-300">En proyectos ejecutados</div>
      </div>

      <div class="text-center">
        <div class="text-5xl lg:text-6xl font-black text-blue-400 mb-4">
          120km
        </div>
        <div class="text-lg font-semibold text-white mb-2">
          Carreteras Construidas
        </div>
        <div class="text-sm text-gray-300">Infraestructura vial</div>
      </div>

      <div class="text-center">
        <div class="text-5xl lg:text-6xl font-black text-purple-400 mb-4">
          15
        </div>
        <div class="text-lg font-semibold text-white mb-2">
          Estados de la Rep√∫blica
        </div>
        <div class="text-sm text-gray-300">Con presencia activa</div>
      </div>
    </div>
  </div> -->
</BaseLayout> 

<style>
  /* Custom animations for portfolio page */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Smooth scrolling */
  html {
    scroll-behavior: smooth;
  }

  /* Enhanced loading states */
  .project-card,
  .project-carousel,
  .project-showcase {
    opacity: 0;
    animation: fadeInUp 0.8s ease-out forwards;
  }

  /* Staggered animation delays */
  .project-card:nth-child(1) {
    animation-delay: 0.1s;
  }
  .project-card:nth-child(2) {
    animation-delay: 0.2s;
  }
  .project-card:nth-child(3) {
    animation-delay: 0.3s;
  }
  .project-card:nth-child(4) {
    animation-delay: 0.4s;
  }
  .project-card:nth-child(5) {
    animation-delay: 0.5s;
  }
  .project-card:nth-child(6) {
    animation-delay: 0.6s;
  }

  /* Intersection Observer will handle the rest */
  @media (prefers-reduced-motion: reduce) {
    .project-card,
    .project-carousel,
    .project-showcase {
      opacity: 1;
      animation: none;
    }
  }
</style>
