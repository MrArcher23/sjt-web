---
// Importar CSS global con Tailwind
import "../styles/globals.css";
import Header from "../components/layout/Header.astro";
import Hero from "../components/ui/Hero.astro";
import StepsSection from "../components/ui/StepsSection.astro";
import SectionInfo from "../components/ui/SectionInfo.astro";
import ServicesSection from "../components/ui/ServicesSection.astro";
import strapi from '../utils/strapi';
import type { StrapiEntity, Hero as HeroType, SectionInfo as SectionInfoType, Header as HeaderType } from '../types/strapi';

// Obtener contenido din√°mico desde Strapi
let heroData: StrapiEntity<HeroType> | null = null;
let sectionInfoData: StrapiEntity<SectionInfoType> | null = null;
let headerData: StrapiEntity<HeaderType> | null = null;
let error: string | null = null;

try {
  // Usar endpoint est√°ndar con filtro para heroes activos
  console.log('üîç Obteniendo heroes activos');
  const heroResponse = await strapi.getActiveHeroes();
  
  // Tomar el primer hero activo (m√°s reciente)
  heroData = heroResponse.data?.[0] || null;
  
  if (heroData) {
    console.log('ü¶∏ Hero activo encontrado:', heroData.title);
  } else {
    console.log('‚ö†Ô∏è No hay heroes activos, probando cualquier hero...');
    const allHeroesResponse = await strapi.getHeroes();
    heroData = allHeroesResponse.data?.[0] || null;
    if (heroData) {
      console.log('ü¶∏ Usando hero m√°s reciente:', heroData.title);
    }
  }
  
  // Obtener SectionInfo desde Strapi
  console.log('üîç Obteniendo section info activa');
  sectionInfoData = await strapi.getActiveSectionInfo();
  if (sectionInfoData) {
    console.log('üìã SectionInfo activa encontrada:', sectionInfoData.title);
  }

  // Obtener Header desde Strapi
  console.log('üîç Obteniendo header activo');
  headerData = await strapi.getActiveHeader();
  if (headerData) {
    console.log('üè† Header activo encontrado:', headerData.companyName);
  }
} catch (e) {
  error = e instanceof Error ? e.message : 'Error loading content';
  console.warn('‚ö†Ô∏è Content loading failed, using fallbacks:', error);
}
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>SJT Contratistas - Construcci√≥n y Infraestructura</title>

    <!-- Fuentes de Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Slab:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="min-h-screen bg-white">
    <!-- Header principal - Contenido din√°mico desde Strapi -->
    {headerData ? (
      <Header
        companyName={headerData.companyName}
        buttonText={headerData.buttonText}
        buttonLink={headerData.buttonLink}
        phoneNumber={headerData.phoneNumber}
        backgroundColor={headerData.backgroundColor}
        logoSrc={headerData.logoSrc}
        logoFile={headerData.logoFile}
        logoAlt={headerData.logoAlt}
      >
        <span slot="tagline">{headerData.subtitle}</span>
        
        <!-- Navegaci√≥n Desktop -->
        <div slot="navigation" class="flex items-center gap-6">
          <a href="/" class="hover:text-yellow-400 transition-colors font-medium">Inicio</a>
          <a href="/services" class="hover:text-yellow-400 transition-colors font-medium">Servicios</a>
          <a href="/projects" class="hover:text-yellow-400 transition-colors font-medium">Proyectos</a>
          <a href="/about" class="hover:text-yellow-400 transition-colors font-medium">Nosotros</a>
          <a href="/contact" class="hover:text-yellow-400 transition-colors font-medium">Contacto</a>
        </div>

        <!-- Navegaci√≥n Mobile -->
        <div slot="mobile-navigation" class="space-y-3">
          <a href="/" class="block py-2 px-4 hover:bg-white/10 rounded-lg transition-colors">Inicio</a>
          <a href="/services" class="block py-2 px-4 hover:bg-white/10 rounded-lg transition-colors">Servicios</a>
          <a href="/projects" class="block py-2 px-4 hover:bg-white/10 rounded-lg transition-colors">Proyectos</a>
          <a href="/about" class="block py-2 px-4 hover:bg-white/10 rounded-lg transition-colors">Nosotros</a>
          <a href="/contact" class="block py-2 px-4 hover:bg-white/10 rounded-lg transition-colors">Contacto</a>
        </div>

        <!-- Informaci√≥n adicional en mobile -->
        <div slot="mobile-extra" class="border-t border-white/20 pt-4">
          <div class="text-center">
            <p class="text-sm opacity-90 mb-2">Emergencias 24/7</p>
            <a href="tel:5551234567" class="text-yellow-400 font-semibold">Llamar ahora</a>
          </div>
        </div>
      </Header>
    ) : (
      <!-- Fallback - Header est√°tico si no hay contenido en Strapi -->
      <Header
        companyName="SJT Contratistas"
        buttonText="Obtener cotizaci√≥n"
        buttonLink="/contact"
        phoneNumber="(555) 123-4567"
        backgroundColor="primary"
      >
        <span slot="tagline">Construcci√≥n e Infraestructura</span>

      <!-- Navegaci√≥n Desktop -->
      <div slot="navigation" class="flex items-center gap-6">
        <a href="/" class="hover:text-yellow-400 transition-colors font-medium"
          >Inicio</a
        >
        <a
          href="/services"
          class="hover:text-yellow-400 transition-colors font-medium"
          >Servicios</a
        >
        <a
          href="/projects"
          class="hover:text-yellow-400 transition-colors font-medium"
          >Proyectos</a
        >
        <a
          href="/about"
          class="hover:text-yellow-400 transition-colors font-medium"
          >Nosotros</a
        >
        <a
          href="/contact"
          class="hover:text-yellow-400 transition-colors font-medium"
          >Contacto</a
        >
      </div>

      <!-- Navegaci√≥n Mobile -->
      <div slot="mobile-navigation" class="space-y-3">
        <a
          href="/"
          class="block py-2 px-4 hover:bg-white/10 rounded-lg transition-colors"
          >Inicio</a
        >
        <a
          href="/services"
          class="block py-2 px-4 hover:bg-white/10 rounded-lg transition-colors"
          >Servicios</a
        >
        <a
          href="/projects"
          class="block py-2 px-4 hover:bg-white/10 rounded-lg transition-colors"
          >Proyectos</a
        >
        <a
          href="/about"
          class="block py-2 px-4 hover:bg-white/10 rounded-lg transition-colors"
          >Nosotros</a
        >
        <a
          href="/contact"
          class="block py-2 px-4 hover:bg-white/10 rounded-lg transition-colors"
          >Contacto</a
        >
      </div>

      <!-- Informaci√≥n adicional en mobile -->
      <div slot="mobile-extra" class="border-t border-white/20 pt-4">
        <div class="text-center">
          <p class="text-sm opacity-90 mb-2">Emergencias 24/7</p>
          <a href="tel:5551234567" class="text-yellow-400 font-semibold"
            >Llamar ahora</a
          >
        </div>
      </div>
    </Header>
    )}

    <!-- Componente Hero - Contenido din√°mico desde Strapi -->
    {heroData ? (
      <Hero
        title={heroData.title}
        subtitle={heroData.subtitle}
        buttonText={heroData.buttonText}
        buttonLink={heroData.buttonLink || "/services"}
        backgroundColor={heroData.backgroundColor || "primary"}
        image={heroData.heroImage?.url ? {
          src: heroData.heroImage.url,
          alt: heroData.heroImage.alternativeText || heroData.title,
          width: heroData.heroImage.width || 800,
          height: heroData.heroImage.height || 600
        } : undefined}
        rating={heroData.rating ? {
          stars: heroData.rating.stars,
          count: heroData.rating.count
        } : undefined}
      >
        <!-- Contenido adicional usando slots -->
        <div slot="additional-content">
          <p class="text-blue-200 mb-4">‚úì Certificaciones internacionales</p>
          <p class="text-blue-200">‚úì Garant√≠a en todos nuestros proyectos</p>
        </div>
      </Hero>
    ) : (
      <!-- Fallback - Hero est√°tico si no hay contenido en Strapi -->
      <Hero
        title="Su socio confiable en construcci√≥n e infraestructura"
        subtitle="Con m√°s de 20 a√±os de experiencia, hemos construido una reputaci√≥n s√≥lida entregando soluciones de construcci√≥n de primera clase adaptadas a sus necesidades en M√©xico."
        buttonText="Explorar nuestros servicios"
        buttonLink="/services"
        backgroundColor="primary"
        rating={{
          stars: 5,
          count: "2000+",
        }}
      >
        <!-- Contenido adicional usando slots -->
        <div slot="additional-content">
          <p class="text-blue-200 mb-4">‚úì Certificaciones internacionales</p>
          <p class="text-blue-200">‚úì Garant√≠a en todos nuestros proyectos</p>
        </div>
      </Hero>
    )}

    <!-- Secci√≥n Steps - Proceso paso a paso -->
    <StepsSection 
      title="¬øC√≥mo trabajamos contigo?"
      subtitle="Nuestro proceso comprobado para llevar tu proyecto de la idea a la realidad"
    />

    <!-- Secci√≥n Info - Contenido din√°mico desde Strapi -->
    {sectionInfoData ? (
      <SectionInfo
        title={sectionInfoData.title}
        description={sectionInfoData.description}
        buttonText={sectionInfoData.buttonText}
        buttonLink={sectionInfoData.buttonLink}
        image={sectionInfoData.image ? {
          src: sectionInfoData.image.url,
          alt: sectionInfoData.image.alternativeText || sectionInfoData.image.name,
          width: sectionInfoData.image.width,
          height: sectionInfoData.image.height
        } : undefined}
        strength1={sectionInfoData.strength1}
        strength2={sectionInfoData.strength2}
        strength3={sectionInfoData.strength3}
        backgroundColor={sectionInfoData.backgroundColor}
        reverseLayout={false}
      />
    ) : (
      <!-- Fallback - SectionInfo est√°tica si no hay contenido en Strapi -->
      <SectionInfo
        title="Soluciones de construcci√≥n adaptadas a tus necesidades"
        description="Nuestro equipo de profesionales con licencia y experiencia est√° comprometido a brindar un servicio r√°pido, profesional y cort√©s, asegurando que tu proyecto de construcci√≥n est√© siempre en condiciones √≥ptimas."
        buttonText="Conoce m√°s sobre nosotros"
        buttonLink="#services"
        image={{
          src: "https://images.unsplash.com/photo-1504307651254-35680f356dfd?ixlib=rb-4.0.3&auto=format&fit=crop&w=2076&q=80",
          alt: "Equipo profesional de construcci√≥n trabajando",
          width: 2076,
          height: 1384
        }}
        strength1="Profesionales certificados y con experiencia"
        strength2="Materiales y equipos de alta calidad"
        strength3="Garant√≠a de satisfacci√≥n del cliente"
        backgroundColor="white"
        reverseLayout={false}
      />
    )}

    <!-- Secci√≥n de servicios din√°micos desde Strapi -->
    <ServicesSection 
      title="Nuestros Servicios"
      subtitle="No vendemos servicios gen√©ricos - dise√±amos la soluci√≥n exacta que necesita."
      backgroundColor="blue-50"
    />

    <!-- Secci√≥n de servicios destacados -->
    <!-- <section class="py-16 bg-gray-50">
      <div class="container mx-auto px-4">
        <div class="text-center mb-12">
          <h2
            class="text-3xl md:text-4xl font-heading font-bold text-gray-900 mb-4"
          >
            Nuestros Servicios Principales
          </h2>
          <p class="text-xl text-gray-600 max-w-2xl mx-auto">
            Ofrecemos soluciones integrales en construcci√≥n e infraestructura
          </p>
        </div>

        <div class="grid md:grid-cols-3 gap-8 max-w-5xl mx-auto">
          <div
            class="text-center bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow"
          >
            <div
              class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-6"
            >
              <span class="text-3xl">üèóÔ∏è</span>
            </div>
            <h3 class="text-xl font-heading font-semibold text-gray-900 mb-4">
              Construcci√≥n
            </h3>
            <p class="text-gray-600">
              Proyectos integrales de construcci√≥n residencial, comercial e
              industrial
            </p>
          </div>

          <div
            class="text-center bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow"
          >
            <div
              class="w-16 h-16 bg-accent-100 rounded-full flex items-center justify-center mx-auto mb-6"
            >
              <span class="text-3xl">üõ£Ô∏è</span>
            </div>
            <h3 class="text-xl font-heading font-semibold text-gray-900 mb-4">
              Infraestructura
            </h3>
            <p class="text-gray-600">
              Desarrollo y mejora de infraestructura urbana y carretera
            </p>
          </div>

          <div
            class="text-center bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow"
          >
            <div
              class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-6"
            >
              <span class="text-3xl">üîß</span>
            </div>
            <h3 class="text-xl font-heading font-semibold text-gray-900 mb-4">
              Mantenimiento
            </h3>
            <p class="text-gray-600">
              Servicios especializados de mantenimiento preventivo y correctivo
            </p>
          </div>
        </div>
      </div>
    </section> -->

    <!-- Footer temporal -->
    <footer class="bg-gray-800 text-white py-8">
      <div class="container mx-auto px-4 text-center">
        <p class="mb-4">
          ¬© 2025 SJT Contratistas SA de CV - Todos los derechos reservados
        </p>
        <div class="flex justify-center gap-6 text-sm">
          <a
            href="/test-strapi"
            class="text-gray-400 hover:text-white transition-colors"
          >
            üîå Test Strapi
          </a>
          <a
            href="/services"
            class="text-gray-400 hover:text-white transition-colors"
          >
            Servicios
          </a>
          <a
            href="/projects"
            class="text-gray-400 hover:text-white transition-colors"
          >
            Proyectos
          </a>
        </div>
      </div>
    </footer>
  </body>
</html>
