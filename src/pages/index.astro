---

// Layout
import BaseLayout from "../layouts/BaseLayout.astro";

// Importar im√°genes locales espec√≠ficas para esta p√°gina
import panoramica1 from "../assets/images/work/panoramica1.jpeg";
import obra1 from "../assets/images/work/obra1.jpeg";
import obra2 from "../assets/images/work/obra2.jpeg";
import obra5 from "../assets/images/work/obra5.jpeg";
import servicio9 from "../assets/images/work/servicio9.jpeg";
import servicio3 from "../assets/images/work/servicio3.jpeg";

// Componentes espec√≠ficos para esta p√°gina
import HeroSection from "../components/HeroSection.astro";
import SectionTitle from "../components/ui/SectionTitle.astro";
import SectionInfo2 from "../components/ui/SectionInfo2.astro";
import CertificationsIso from "../components/ui/CertificationsIso.astro";
import ServiceCard from "../components/ui/ServiceCard.astro";
import ServiceGallery from "../components/ui/ServiceGallery.astro";

// L√≥gica espec√≠fica para la p√°gina de inicio
import strapi from "../utils/strapi";
import type {
  StrapiEntity,
  Hero as HeroType,
  TitleSectionInfo as TitleSectionInfoType,
} from "../types/strapi";
import TitleSectionInfo from "../components/TitleSectionInfo.astro";

// Obtener contenido espec√≠fico para la home
let heroData: StrapiEntity<HeroType> | null = null;

let titleSectionData: TitleSectionInfoType | null = null;
let misionSectionData: TitleSectionInfoType | null = null;
let visionSectionData: TitleSectionInfoType | null = null;
let error: string | null = null;

try {
  // üöÄ OPTIMIZACI√ìN: Llamadas paralelas con Promise.all()
  console.log("üîç Obteniendo datos de Strapi en paralelo para index...");
  const startTime = performance.now();
  
  // Primero intentamos obtener heroes activos y title sections en paralelo
  const [
    heroResponse,
    titleSectionData_temp,
    misionSectionData_temp,
    visionSectionData_temp
  ] = await Promise.all([
    strapi.getActiveHeroes(),
    strapi.getTitleSectionInfoByIdentifier("landing-somos"),
    strapi.getTitleSectionInfoByIdentifier("landing-mision"),
    strapi.getTitleSectionInfoByIdentifier("landing-vision")
  ]);

  // Procesar hero data
  heroData = heroResponse.data?.[0] || null;

  // Si no hay heroes activos, hacer fallback (solo si es necesario)
  if (!heroData) {
    console.log("‚ö†Ô∏è No hay heroes activos, obteniendo cualquier hero...");
    const allHeroesResponse = await strapi.getHeroes();
    heroData = allHeroesResponse.data?.[0] || null;
  }

  // Asignar resultados de title sections
  titleSectionData = titleSectionData_temp;
  misionSectionData = misionSectionData_temp;
  visionSectionData = visionSectionData_temp;
  
  const endTime = performance.now();
  console.log(`‚úÖ Datos de index obtenidos en paralelo - Tiempo: ${(endTime - startTime).toFixed(2)}ms`);
  console.log(`üìä Datos cargados: Hero: ${heroData ? "‚úÖ" : "‚ùå"}, Sections: ${[titleSectionData, misionSectionData, visionSectionData].filter(Boolean).length}/3`);

} catch (e) {
  error = e instanceof Error ? e.message : "Error loading data";
  console.error("‚ùå Error cargando datos:", error);
}

// Datos de servicios (reemplaza StrapiServiceGallery que buscaba content-type inexistente)
const serviceGalleryData = [
  {
    service_name: "Construcci√≥n & Obra Civil",
    img: obra5.src,
    overlayColor: "black" as const,
    description: "Construcci√≥n y desarrollo de infraestructura civil",
    link: "/servicios"
  },
  {
    service_name: "Terracer√≠as & Carreteras", 
    img: obra2.src,
    overlayColor: "black" as const,
    description: "Desarrollo y construcci√≥n de carreteras, caminos y terracer√≠as con tecnolog√≠a avanzada",
    link: "/servicios"
  },
  {
    service_name: "Mec√°nica & Electromec√°nica",
    img: servicio9.src,
    overlayColor: "black" as const, 
    description: "Sistemas electromec√°nicos industriales",
    link: "/servicios"
  },
  {
    service_name: "Desarrollo de Proyectos",
    img: servicio3.src,
    overlayColor: "black" as const,
    description: "Mantenimiento preventivo y correctivo",
    link: "/servicios"
  }
];

// Transformar datos para los componentes
const heroProps = heroData
  ? {
      name_company: heroData.companyName,
      subtitle: heroData.subtitle,
      showOverlay: heroData.showOverlay,
      titlePosition: heroData.titlePosition as "center" | "bottom",
      backgroundVideo: heroData.backgroundVideo?.url ? { src: heroData.backgroundVideo.url } : undefined,
      backgroundImage: heroData.backgroundImage?.url,
    }
  : null;



// Props espec√≠ficas para el Layout de la home
const layoutProps = {
  pageTitle: "Inicio",
  metaDescription: "SJT Contratistas - L√≠deres en construcci√≥n, obra civil, terracer√≠as y desarrollo integral de proyectos en el sureste mexicano. M√°s de 20 a√±os de experiencia y excelencia.",
  showBreadcrumb: false,
  showContact: true,
  contactConfig: {
    highlightText: "escribenos y te atenderemos",
    title: "¬øTE INTERESA SABER M√ÅS?",
    subtitle: "Ponte en contacto con nosotros y te brindaremos toda la informaci√≥n que necesites sobre nuestros servicios de construcci√≥n.",
    phone: "(993) 167-4490",
    email: "asastre@sjtcontratistas.com",
    address: "Carr. Reforma-Dos Bocas s/n, Cumuapa 1ra. Tabasco",
    placeholder: "Escribe tu Email...",    
  },
};
---

<BaseLayout {...layoutProps}>
  <!-- ========================================= -->
  <!-- CONTENIDO ESPEC√çFICO DE LA P√ÅGINA HOME -->
  <!-- ========================================= -->

  <!-- Hero Section -->
  {heroProps ? (
    <HeroSection
      name_company={heroProps.name_company}
      subtitle={heroProps.subtitle}
      showOverlay={heroProps.showOverlay}
      titlePosition={heroProps.titlePosition}
      backgroundVideo={heroProps.backgroundVideo}
      backgroundImage={heroProps.backgroundImage}
    />
  ) : (
    <!-- Fallback Hero si no hay datos de Strapi -->
    <HeroSection
      name_company="Construcci√≥n y Desarrollo Integral"
      subtitle="M√°s de 20 a√±os transformando el sureste mexicano con proyectos de excelencia"
      showOverlay={true}
      titlePosition="center"
      backgroundImage={panoramica1.src}
    />
  )}
  <CertificationsIso borderColor="blue" />

  <!-- Secci√≥n "Qui√©nes Somos" desde Strapi -->
  {titleSectionData ? (
    <TitleSectionInfo
      highlightText={titleSectionData.highlightText}
      title={titleSectionData.title}
      titleSection={titleSectionData.titleSection}
      highlightColor={titleSectionData.highlightColor || "blue"}
      customColor={titleSectionData.customColor}
      alignment={titleSectionData.alignment || "left"}
      size={titleSectionData.size || "lg"}
      description={titleSectionData.description}
      image={titleSectionData.image?.url || obra1.src}
      imageAlt={titleSectionData.imageAlt || titleSectionData.image?.alternativeText}
      imagePosition={titleSectionData.imagePosition || "right"}
      buttonText={titleSectionData.buttonText}
      buttonLink={titleSectionData.buttonLink}
      floatingElement1={titleSectionData.floatingElement1 ? {
        number: titleSectionData.floatingElement1.number,
        title: titleSectionData.floatingElement1.title,
        subtitle: titleSectionData.floatingElement1.subtitle,
        svg: titleSectionData.floatingElement1.svg,
        bgColor: titleSectionData.floatingElement1.bgColor || "bg-gray-900",
        textColor: titleSectionData.floatingElement1.textColor || "text-white"
      } : undefined}
      floatingElement2={titleSectionData.floatingElement2 ? {
        number: titleSectionData.floatingElement2.number,
        title: titleSectionData.floatingElement2.title,
        subtitle: titleSectionData.floatingElement2.subtitle,
        svg: titleSectionData.floatingElement2.svg,
        bgColor: titleSectionData.floatingElement2.bgColor || "bg-orange-500",
        textColor: titleSectionData.floatingElement2.textColor || "text-white"
      } : undefined}
      backgroundColor={titleSectionData.backgroundColor}
      containerClass={titleSectionData.containerClass}
      sectionClass={titleSectionData.sectionClass}
      titleContainerClass={titleSectionData.titleContainerClass}
    />
  ) : (
    <!-- Fallback: Secci√≥n hardcodeada si no hay datos de Strapi -->
    <TitleSectionInfo
      highlightText="qui√©nes somos"
      title="L√çDERES EN LA INDUSTRIA DE CONSTRUCCI√ìN"
      titleSection="Comprometidos con la Calidad, Medio Ambiente y Seguridad"
      highlightColor="blue"
      alignment="left"
      size="lg"
      description="Somos una empresa tabasque√±a y orgullosamente mexicana, comprometida con la m√°s alta calidad en nuestros productos as√≠ como en nuestros servicios."
      image={obra1.src}
      imagePosition="right"
      buttonText="M√°s informaci√≥n"
      buttonLink="/quienes-somos"
      floatingElement1={{
        number: "500+",
        title: "Proyectos",
        subtitle: "Realizados",
        svg: `<svg class="w-full h-full" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3l8 8v9a1 1 0 01-1 1h-6v-6H9v6H3a1 1 0 01-1-1v-9l8-8z"/></svg>`,
        bgColor: "bg-gray-900",
        textColor: "text-white"
      }}
      floatingElement2={{
        number: "03+",
        title: "Certificaciones",
        subtitle: "Internacionales",
        svg: `<svg class="w-full h-full" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9l-5.91.74L12 22l-3.09-6.26L2 15l5.91-.74L12 2z"/></svg>`,
        bgColor: "bg-orange-500",
        textColor: "text-white"
      }}
    />
  )}


  <div class="mx-8 sm:mx-12 lg:mx-16 xl:mx-20 px-0 mb-12">
    <SectionTitle
      highlightText="nuestros servicios"
      title="Nuestros Servicios: Profesionalismo y Excelencia"
      highlightColor="orange"
      alignment="left"
      size="lg"
    />
    <ServiceGallery
      services={serviceGalleryData}
      buttonColor="bg-yellow-500"
    />

  </div>

  
  
  <!-- Misi√≥n Section desde Strapi -->
  {misionSectionData ? (
    <TitleSectionInfo
      highlightText={misionSectionData.highlightText}
      title={misionSectionData.title}
      titleSection={misionSectionData.titleSection}
      highlightColor={misionSectionData.highlightColor || "red"}
      customColor={misionSectionData.customColor}
      alignment={misionSectionData.alignment || "left"}
      size={misionSectionData.size || "lg"}
      description={misionSectionData.description}
      image={misionSectionData.image?.url || obra1.src}
      imageAlt={misionSectionData.imageAlt || misionSectionData.image?.alternativeText}
      imagePosition={misionSectionData.imagePosition || "right"}
      buttonText={misionSectionData.buttonText}
      buttonLink={misionSectionData.buttonLink}
      floatingElement1={misionSectionData.floatingElement1 ? {
        number: misionSectionData.floatingElement1.number,
        title: misionSectionData.floatingElement1.title,
        subtitle: misionSectionData.floatingElement1.subtitle,
        svg: misionSectionData.floatingElement1.svg,
        bgColor: misionSectionData.floatingElement1.bgColor || "bg-red",
        textColor: misionSectionData.floatingElement1.textColor || "text-white"
      } : undefined}
      floatingElement2={misionSectionData.floatingElement2 ? {
        number: misionSectionData.floatingElement2.number,
        title: misionSectionData.floatingElement2.title,
        subtitle: misionSectionData.floatingElement2.subtitle,
        svg: misionSectionData.floatingElement2.svg,
        bgColor: misionSectionData.floatingElement2.bgColor || "bg-orange",
        textColor: misionSectionData.floatingElement2.textColor || "text-white"
      } : undefined}
    />
  ) : (
    <!-- Fallback: Secci√≥n hardcodeada si no hay datos de Strapi -->
    <section class="py-16 bg-white">
      <div class="mx-8 sm:mx-12 lg:mx-16 xl:mx-20 px-0 mb-12">
        <SectionTitle
          highlightText="nuestra MISI√ìN"
          title="Nuestra Misi√≥n: Calidad, Integridad y Crecimiento"
          highlightColor="red"
          alignment="left"
          size="lg"
        />
      </div>
      <SectionInfo2
        title="Compromiso con la Excelencia y el Desarrollo"
        description="Ofrecer a nuestros clientes productos y servicios de ingenier√≠a de excelente calidad en los tiempos establecidos, mediante una gesti√≥n √≠ntegra y honesta, ofreciendo estabilidad laboral y oportunidades de desarrollo al personal que labora en la empresa, asegurando la inversi√≥n de los clientes y excediendo sus expectativas, a fin de garantizar la rentabilidad de las operaciones y el cumplimiento de los compromisos asumidos con los proveedores."
        image={obra1.src}
        imagePosition="right"
        buttonText="M√°s informaci√≥n"
        buttonLink="/quienes-somos"         
      />
    </section>
  )}

  <!-- Visi√≥n Section desde Strapi -->
  {visionSectionData ? (
    <TitleSectionInfo
      highlightText={visionSectionData.highlightText}
      title={visionSectionData.title}
      titleSection={visionSectionData.titleSection}
      highlightColor={visionSectionData.highlightColor || "blue"}
      customColor={visionSectionData.customColor}
      alignment={visionSectionData.alignment || "left"}
      size={visionSectionData.size || "lg"}
      description={visionSectionData.description}
      image={visionSectionData.image?.url || obra1.src}
      imageAlt={visionSectionData.imageAlt || visionSectionData.image?.alternativeText}
      imagePosition={visionSectionData.imagePosition || "left"}
      buttonText={visionSectionData.buttonText}
      buttonLink={visionSectionData.buttonLink}
      floatingElement1={visionSectionData.floatingElement1 ? {
        number: visionSectionData.floatingElement1.number,
        title: visionSectionData.floatingElement1.title,
        subtitle: visionSectionData.floatingElement1.subtitle,
        svg: visionSectionData.floatingElement1.svg,
        bgColor: visionSectionData.floatingElement1.bgColor || "bg-blue",
        textColor: visionSectionData.floatingElement1.textColor || "text-white"
      } : undefined}
      floatingElement2={visionSectionData.floatingElement2 ? {
        number: visionSectionData.floatingElement2.number,
        title: visionSectionData.floatingElement2.title,
        subtitle: visionSectionData.floatingElement2.subtitle,
        svg: visionSectionData.floatingElement2.svg,
        bgColor: visionSectionData.floatingElement2.bgColor || "bg-green",
        textColor: visionSectionData.floatingElement2.textColor || "text-white"
      } : undefined}
    />
  ) : (
    <!-- Fallback: Secci√≥n hardcodeada si no hay datos de Strapi -->
    <section class="py-16 bg-white">
      <div class="mx-8 sm:mx-12 lg:mx-16 xl:mx-20 px-0 mb-12">
        <SectionTitle
          highlightText="nuestra visi√ìN"
          title="Nuestra Visi√≥n: Liderazgo Din√°mico y Vanguardista"
          highlightColor="blue"
          alignment="left"
          size="lg"
        />
      </div>
      <SectionInfo2
        title="Liderazgo e Innovaci√≥n en Vanguardia"
        description="ser reconocida como una empresa l√≠der y din√°mica, comprometidos a romper esquemas, coloc√°ndonos a la vanguardia en todos y cada uno de nuestros procesos para nuestros proyectos, productos y servicios."
        image={obra1.src}
        imagePosition="left"
        buttonText="M√°s informaci√≥n"
        buttonLink="/quienes-somos"         
      />
    </section>
  )}

  <section class="py-16 bg-white">
    <div class="mx-8 sm:mx-12 lg:mx-16 xl:mx-20 px-0 mb-12">
      <SectionTitle
        highlightText="conoce mas de nosotros"
        title="Explora mas de SJT Contratistas"
        highlightColor="orange"
        alignment="center"
        size="lg"
      />
    </div>
    
    
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">
        
       
        <ServiceCard
          area='<path d="M12 3l8 8v9a1 1 0 01-1 1h-6v-6H9v6H3a1 1 0 01-1-1v-9l8-8z"/>'
          serviceName="Quienes Somos"
          description="Conoce mas de nosotros, nuestra historia, nuestros valores, nuestros objetivos y nuestros servicios."
          buttonText="Ver m√°s"
          href="/quienes-somos"
          cardNumber="01"
          iconColor="#FF5722"
        />

       
        <ServiceCard
          area='<path d="M13 10V3L4 14h7v7l9-11h-7z"/>'
          serviceName="Portafolio"
          description="Conoce nuestros proyectos realizados, nuestros clientes y nuestros resultados."
          buttonText="Ver m√°s"
          href="/portafolio"
          cardNumber="02"
          iconColor="#FF5722"
        />

       
        <ServiceCard
          area='<path d="M12 2l3.09 6.26L22 9l-5.91.74L12 22l-3.09-6.26L2 15l5.91-.74L12 2z"/><circle cx="12" cy="12" r="3"/>'
          serviceName="Servicios"
          description="Conoce nuestros servicios, nuestros productos y nuestros procesos."
          buttonText="Ver m√°s"
          href="/servicios"
          cardNumber="03"
          iconColor="#FF5722"
        />

      </div>
    </div>
   
  </section>
  

</BaseLayout>

